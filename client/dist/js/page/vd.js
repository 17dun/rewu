"use strict";zeus.page({initDatas:function(){self.list=[],self.allNum=0},initParts:function(){var t=this;t.parts={$form:$("#queryBox"),$table:$("#listBox")},t.getList()},bindEvent:function(){var t=this,e=t.parts.$form.find(".query-btn");e.on("click",function(){t.getList()});var n=t.parts.$form.find(".add-btn");n.on("click",function(){t.add()}),$("#listBody").on("click",".edit-btn",function(){t.edit(this)}),$("#listBody").on("click",".del-btn",function(){var e=$(this).parent().parent().data("itemid");t.del(e)}),$("#listBody").on("click",".del-btn",function(){var e=$(this).parent().parent().data("itemid");t.del(e)}),$("#listBox").on("click",".all-check",function(){t.allcheck($(this).is(":checked"))}),$(".delall-btn").on("click",function(){t.alldel()}),$(".set-all").on("click",function(){t.allSet()}),$("#listBody").on("click",".rt-btn",function(){var e=$(this).parent().parent().data("itemid");t.setChannel(e,1)}),$("#listBody").on("click",".fs-btn",function(){var e=$(this).parent().parent().data("itemid");t.setChannel(e,0)}),$("#listBody").on("click",".checkTr",function(){var t=$(this).find(".item-check");$(this).find(".item-check ").prop("checked",!t.prop("checked"))}),$("#listBody").on("change",".channelBox",function(){var e=$(this).parent().parent().data("itemid");t.setChannel(e,$(this).val())})},setChannel:function(t,e){$.ajax({url:"/vd/setchannel",type:"GET",dataType:"json",data:{vid:t,channel:e},success:function(t){t.code?self.msg(0):self.msg(1),self.getList()},error:function(t){self.msg(0)}})},alldel:function(){$("#delBox").dialog({title:"警告",modal:!0,width:300,buttons:[{text:"确定",click:function(){var t=[];$(".item-check:checked").each(function(e,n){t.push($(n).parent().parent().data("itemid"))}),$.ajax({url:"/vd/delall",type:"POST",dataType:"json",data:{ids:t},success:function(t){t.code?self.msg(0):self.getList()},error:function(t){self.msg(0)}}),$(this).dialog("close")}},{text:"取消",click:function(){$(this).dialog("close")}}]})},allSet:function(){var t=[];$(".item-check:checked").each(function(e,n){t.push($(n).parent().parent().data("itemid"))});var e=$("#setAll").val();$.ajax({url:"/vd/setall",type:"POST",dataType:"json",data:{ids:t,channel:e},success:function(t){t.code?self.msg():self.getList()},error:function(t){self.msg()}})},allcheck:function(t){$(".item-check").each(function(e,n){$(n).prop("checked",t)})},getList:function(){var t=this,e=t.parts.$form.serialize();$.ajax({url:"/vd/list",type:"GET",dataType:"json",data:e,success:function(e){t.list=e.data,t.channelList=e.channelList,t.allNum=e.allNum,t.renderList()},error:function(t){}})},renderList:function(){$("#allNum").html(self.allNum),$("#listNum").html(self.list.length),$("#listBody").empty(),$("#listTemp").tmpl(self.list).appendTo("#listBody"),$(".all-check").prop("checked",!1),self.renderChannelList()},renderChannelList:function(){$(".channelBox").append($("#channelTemp").tmpl(self.channelList))},add:function(){var t=this;t.edit()},renderEdit:function(t){$("#editBox").empty(),$("#editFormTemp").tmpl(t).appendTo("#editBox")},edit:function(t){var e=this;if(t)var n=$(".edit-btn").index(t),i=e.list[n];else;e.renderEdit(i),$("#editBox").dialog({title:"编辑",modal:!0,width:300,buttons:[{text:"保存",click:function(){var t=this;e.save(function(){e.getList(),e.msg(1),$(t).dialog("close")})}}]})},save:function(t){var e=this,n=$("#editform").serialize();console.log(n),$.ajax({url:"/vd/save",type:"GET",dataType:"json",data:n,success:function(e){t()},error:function(t){e.msg(0,"保存失败")}})},del:function(t){var e=this;$("#delBox").dialog({title:"警告",modal:!0,width:300,buttons:[{text:"确定",click:function(){$.ajax({url:"/vd/del?id="+t,type:"GET",dataType:"json",success:function(t){e.msg(1),e.getList()},error:function(t){e.msg(0)}}),$(this).dialog("close")}},{text:"取消",click:function(){$(this).dialog("close")}}]})},msg:function(t,e){var n=$("#bgMsg");t?(n.addClass("alert-success"),n.removeClass("alert-danger"),n.html("操作成功")):(n.addClass("alert-danger"),n.removeClass("alert-success"),n.html("操作失败")),e&&n.html(e),n.animate({opacity:1}),n.animate({opacity:0},800)}});